!function(){"use strict";var e="/";const t={formSelector:".modal__form",inputSelector:".modal__input",submitButtonSelector:".modal__submit-btn",inactiveButtonClass:"modal__submit-btn--disabled",inputErrorClass:"modal__input--error",errorClass:"modal__error--active"},r=(e,t)=>{const r=document.querySelector(`#${e.id}-error`);r&&(e.classList.remove(t.inputErrorClass),r.textContent="",r.classList.remove(t.errorClass))},n=(e,t)=>{const n=Array.from(e.querySelectorAll(t.inputSelector)),a=e.querySelector(t.submitButtonSelector);n.forEach((e=>{r(e,t)})),o(n,a,t)},o=(e,t,r)=>{(e=>e.some((e=>!e.validity.valid)))(e)?(t.classList.add(r.inactiveButtonClass),t.setAttribute("disabled",!0)):(t.classList.remove(r.inactiveButtonClass),t.removeAttribute("disabled"))};var a=e+"images/avatar.jpg";function s(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Save",n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"Saving...";t.textContent=e?n:r}function i(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Saving...";t.preventDefault();const n=t.submitter,o=n.textContent;return s(!0,n,o,r),e().then((()=>{t.target.reset()})).catch(console.error).finally((()=>{s(!1,n,o)}))}const l=document.querySelector(".cards__list"),c=document.querySelector("#card-template"),d=document.querySelector("#preview-modal"),u=d?.querySelector(".modal__image"),m=d?.querySelector(".modal__caption"),_=document.querySelector(".profile__name"),h=document.querySelector(".profile__description"),v=document.querySelector("#edit-profile-modal"),f=document.querySelector("#new-post-modal"),p=document.querySelector(".profile__avatar"),y=document.querySelector(".profile__picture-btn"),S=document.querySelector(".profile__add-btn"),q=document.querySelectorAll(".modal__close-btn, .modal__close-preview"),b=document.querySelector("#delete-modal"),E=b.querySelector(".modal__submit-btn_delete"),g=b.querySelector(".modal__submit-btn_cancel"),C=document.querySelector("#edit-avatar-modal"),L=C.querySelector("#avatar_url"),k=C.querySelector(".modal__submit-btn"),x=document.querySelector(".profile__edit-btn"),w=document.forms["edit-profile"],A=document.forms["edit-avatar"],U=document.forms["new-post"],P=U.querySelector("#new-post-caption-input"),D=U.querySelector("#image_url");let I,T,$;const B=new class{constructor(e){let{baseUrl:t,headers:r}=e;this._baseUrl=t,this._headers=r}_checkResponse(e){return e.ok?e.json():Promise.reject(new Error(`Error: ${e.status}`))}_request(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return fetch(`${this._baseUrl}${e}`,t).then(this._checkResponse).catch(this.handleError)}getUserInfo(){return this._request("/users/me",{headers:this._headers})}getInitialCards(){return this._request("/cards",{headers:this._headers})}editProfileAvatar(e){let{avatar:t}=e;return this._request("/users/me/avatar",{method:"PATCH",headers:this._headers,body:JSON.stringify({avatar:t})})}editUserInfo(e){let{name:t,about:r}=e;return this._request("/users/me",{method:"PATCH",headers:this._headers,body:JSON.stringify({name:t,about:r})})}addNewCard(e){let{name:t,link:r}=e;return this._request("/cards",{method:"POST",headers:this._headers,body:JSON.stringify({name:t,link:r})})}deleteCard(e){return this._request(`/cards/${e}`,{method:"DELETE",headers:this._headers})}toggleLike(e,t){return this._request(`/cards/${e}/likes`,{method:t?"PUT":"DELETE",headers:this._headers})}getUserAndCards(){return Promise.all([this.getUserInfo(),this.getInitialCards()]).then((e=>{let[t,r]=e;return{userData:t,cards:r}}))}handleError(e){throw console.error("API Error: ",e),e}}({baseUrl:"https://around-api.en.tripleten-services.com/v1",headers:{authorization:"46c1a639-4215-418c-8205-87dec37d68b7","Content-Type":"application/json"}});function N(e){const t=c.content.querySelector("li").cloneNode(!0),r=t.querySelector(".card__image"),n=t.querySelector(".card__title"),o=t.querySelector(".card__like-btn"),a=t.querySelector(".card__delete-btn");return r.src=e.link,r.alt=e.name,n.textContent=e.name,e.isLiked&&o.classList.add("card__like-btn--liked"),o.addEventListener("click",(()=>{const t=o.classList.contains("card__like-btn--liked");B.toggleLike(e._id,!t).then((e=>{o.classList.toggle("card__like-btn--liked",e.isLiked)})).catch((e=>console.error("Error toggling like:",e)))})),r.addEventListener("click",(()=>{return t=e.link,r=e.name,void(d&&u&&m&&(u.src=t,u.alt=r,m.textContent=r,j(d)));var t,r})),a.addEventListener("click",(r=>{r.stopPropagation(),I=t,T=e._id,j(b)})),t}function O(e){e.preventDefault();const t=L.value.trim();if(t){const r=k.textContent;function n(){return B.editProfileAvatar({avatar:t}).then((e=>{p.src=e.avatar||a,J(C)}))}k.textContent="Saving...",i(n,e).finally((()=>{k.textContent=r}))}}function j(e){e.classList.add("modal--opened"),document.addEventListener("keydown",H),e.addEventListener("click",M)}function J(e){e.classList.remove("modal--opened"),document.removeEventListener("keydown",H),e.removeEventListener("click",M)}function H(e){if("Escape"===e.key){const e=document.querySelector(".modal--opened");e&&J(e)}}function M(e){e.target.classList.contains("modal")&&J(e.target)}function R(e){i((function(){return B.editUserInfo({name:w.name.value,about:w.description.value}).then((e=>{_.textContent=e.name,h.textContent=e.about,J(v)}))}),e)}function z(e){e.preventDefault();const t=P.value.trim(),r=D.value.trim();i((function(){return B.addNewCard({name:t,link:r}).then((e=>{const t=N(e);l.prepend(t),J(f)}))}),e)}var F;B.getUserInfo().then((e=>{$=e._id,_.textContent=e.name,h.textContent=e.about,p.src=e.avatar||a})).catch((e=>console.error("Error fetching user info:",e))),B.getInitialCards().then((e=>{e.forEach((e=>{const t=N(e);l.appendChild(t)}))})).catch((e=>console.error("Error loading cards:",e))),E.addEventListener("click",(e=>{if(e.preventDefault(),T){const e=E.textContent;E.textContent="Deleting...",B.deleteCard(T).then((()=>{I.remove(),I=null,T=null,J(b)})).catch((e=>console.error("Error deleting card:",e))).finally((()=>{E.textContent=e}))}})),g.addEventListener("click",(()=>{J(b),I=null,T=null})),y.addEventListener("click",(()=>{j(C),n(A,t)})),document.addEventListener("DOMContentLoaded",(()=>{S.addEventListener("click",(()=>{const e=document.forms["new-post"];j(f),n(e,t),e.querySelector("input[name='new-post-caption-input']"),e.querySelector("input[name='image_url']")})),x.addEventListener("click",(()=>{w.name.value=_.textContent,w.description.value=h.textContent,j(v),n(w,t)})),w.addEventListener("submit",R),document.forms["new-post"].addEventListener("submit",z),A.addEventListener("submit",O),q.forEach((e=>e.addEventListener("click",(()=>J(e.closest(".modal"))))))})),F=t,document.querySelectorAll(F.formSelector).forEach((e=>{((e,t)=>{const n=Array.from(e.querySelectorAll(t.inputSelector)),a=e.querySelector(t.submitButtonSelector);n.forEach((e=>{e.addEventListener("input",(()=>{((e,t,n)=>{t.validity.valid?r(t,n):((e,t,r)=>{const n=document.querySelector(`#${e.id}-error`);n&&(e.classList.add(r.inputErrorClass),n.textContent=t,n.classList.add(r.errorClass))})(t,t.validationMessage,n)})(0,e,t),o(n,a,t)}))})),o(n,a,t)})(e,F)}))}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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RUFNaEQwSyxDQUFrQmpLLEVBQWFULEVBQU8sRyIsInNvdXJjZXMiOlsid2VicGFjazovL3NlX3Byb2plY3Rfc3BvdHMvd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vc2VfcHJvamVjdF9zcG90cy93ZWJwYWNrL3J1bnRpbWUvcHVibGljUGF0aCIsIndlYnBhY2s6Ly9zZV9wcm9qZWN0X3Nwb3RzLy4vc3JjL3ZhbGlkYXRpb24uanMiLCJ3ZWJwYWNrOi8vc2VfcHJvamVjdF9zcG90cy8uL3NyYy91dGlscy9BcGkuanMiLCJ3ZWJwYWNrOi8vc2VfcHJvamVjdF9zcG90cy8uL3NyYy91dGlscy9mb3JtaGFuZGxlci5qcyIsIndlYnBhY2s6Ly9zZV9wcm9qZWN0X3Nwb3RzLy4vc3JjL3BhZ2VzL2luZGV4LmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIFRoZSByZXF1aXJlIHNjb3BlXG52YXIgX193ZWJwYWNrX3JlcXVpcmVfXyA9IHt9O1xuXG4iLCJfX3dlYnBhY2tfcmVxdWlyZV9fLnAgPSBcIi9cIjsiLCJleHBvcnQgY29uc3QgU2V0dGluZ3MgPSB7XHJcbiAgZm9ybVNlbGVjdG9yOiBcIi5tb2RhbF9fZm9ybVwiLFxyXG4gIGlucHV0U2VsZWN0b3I6IFwiLm1vZGFsX19pbnB1dFwiLFxyXG4gIHN1Ym1pdEJ1dHRvblNlbGVjdG9yOiBcIi5tb2RhbF9fc3VibWl0LWJ0blwiLFxyXG4gIGluYWN0aXZlQnV0dG9uQ2xhc3M6IFwibW9kYWxfX3N1Ym1pdC1idG4tLWRpc2FibGVkXCIsXHJcbiAgaW5wdXRFcnJvckNsYXNzOiBcIm1vZGFsX19pbnB1dC0tZXJyb3JcIixcclxuICBlcnJvckNsYXNzOiBcIm1vZGFsX19lcnJvci0tYWN0aXZlXCIsXHJcbn07XHJcblxyXG5jb25zdCBzaG93SW5wdXRFcnJvciA9IChpbnB1dEVsZW1lbnQsIGVycm9yTWVzc2FnZSwgY29uZmlnKSA9PiB7XHJcbiAgY29uc3QgZXJyb3JFbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgIyR7aW5wdXRFbGVtZW50LmlkfS1lcnJvcmApO1xyXG4gIGlmICghZXJyb3JFbGVtZW50KSByZXR1cm47XHJcblxyXG4gIGlucHV0RWxlbWVudC5jbGFzc0xpc3QuYWRkKGNvbmZpZy5pbnB1dEVycm9yQ2xhc3MpO1xyXG4gIGVycm9yRWxlbWVudC50ZXh0Q29udGVudCA9IGVycm9yTWVzc2FnZTtcclxuICBlcnJvckVsZW1lbnQuY2xhc3NMaXN0LmFkZChjb25maWcuZXJyb3JDbGFzcyk7XHJcbn07XHJcblxyXG5jb25zdCBoaWRlSW5wdXRFcnJvciA9IChpbnB1dEVsZW1lbnQsIGNvbmZpZykgPT4ge1xyXG4gIGNvbnN0IGVycm9yRWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYCMke2lucHV0RWxlbWVudC5pZH0tZXJyb3JgKTtcclxuICBpZiAoIWVycm9yRWxlbWVudCkgcmV0dXJuO1xyXG5cclxuICBpbnB1dEVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZShjb25maWcuaW5wdXRFcnJvckNsYXNzKTtcclxuICBlcnJvckVsZW1lbnQudGV4dENvbnRlbnQgPSBcIlwiO1xyXG4gIGVycm9yRWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKGNvbmZpZy5lcnJvckNsYXNzKTtcclxufTtcclxuXHJcbmNvbnN0IGNoZWNrSW5wdXRWYWxpZGl0eSA9IChmb3JtRWxlbWVudCwgaW5wdXRFbGVtZW50LCBjb25maWcpID0+IHtcclxuICBpZiAoIWlucHV0RWxlbWVudC52YWxpZGl0eS52YWxpZCkge1xyXG4gICAgc2hvd0lucHV0RXJyb3IoaW5wdXRFbGVtZW50LCBpbnB1dEVsZW1lbnQudmFsaWRhdGlvbk1lc3NhZ2UsIGNvbmZpZyk7XHJcbiAgfSBlbHNlIHtcclxuICAgIGhpZGVJbnB1dEVycm9yKGlucHV0RWxlbWVudCwgY29uZmlnKTtcclxuICB9XHJcbn07XHJcblxyXG5leHBvcnQgY29uc3QgcmVzZXRWYWxpZGF0aW9uID0gKGZvcm1FbGVtZW50LCBjb25maWcpID0+IHtcclxuICBjb25zdCBpbnB1dExpc3QgPSBBcnJheS5mcm9tKGZvcm1FbGVtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoY29uZmlnLmlucHV0U2VsZWN0b3IpKTtcclxuICBjb25zdCBzdWJtaXRCdXR0b24gPSBmb3JtRWxlbWVudC5xdWVyeVNlbGVjdG9yKGNvbmZpZy5zdWJtaXRCdXR0b25TZWxlY3Rvcik7XHJcblxyXG4gIGlucHV0TGlzdC5mb3JFYWNoKChpbnB1dEVsZW1lbnQpID0+IHtcclxuICAgIGhpZGVJbnB1dEVycm9yKGlucHV0RWxlbWVudCwgY29uZmlnKTtcclxuICB9KTtcclxuXHJcbiAgdG9nZ2xlQnV0dG9uU3RhdGUoaW5wdXRMaXN0LCBzdWJtaXRCdXR0b24sIGNvbmZpZyk7XHJcbn07XHJcblxyXG5jb25zdCBoYXNJbnZhbGlkSW5wdXQgPSAoaW5wdXRMaXN0KSA9PiBpbnB1dExpc3Quc29tZSgoaW5wdXQpID0+ICFpbnB1dC52YWxpZGl0eS52YWxpZCk7XHJcblxyXG5jb25zdCB0b2dnbGVCdXR0b25TdGF0ZSA9IChpbnB1dExpc3QsIGJ1dHRvbkVsZW1lbnQsIGNvbmZpZykgPT4ge1xyXG4gIGlmIChoYXNJbnZhbGlkSW5wdXQoaW5wdXRMaXN0KSkge1xyXG4gICAgYnV0dG9uRWxlbWVudC5jbGFzc0xpc3QuYWRkKGNvbmZpZy5pbmFjdGl2ZUJ1dHRvbkNsYXNzKTtcclxuICAgIGJ1dHRvbkVsZW1lbnQuc2V0QXR0cmlidXRlKFwiZGlzYWJsZWRcIiwgdHJ1ZSk7XHJcbiAgfSBlbHNlIHtcclxuICAgIGJ1dHRvbkVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZShjb25maWcuaW5hY3RpdmVCdXR0b25DbGFzcyk7XHJcbiAgICBidXR0b25FbGVtZW50LnJlbW92ZUF0dHJpYnV0ZShcImRpc2FibGVkXCIpO1xyXG4gIH1cclxufTtcclxuXHJcbmNvbnN0IHNldEV2ZW50TGlzdGVuZXJzID0gKGZvcm1FbGVtZW50LCBjb25maWcpID0+IHtcclxuICBjb25zdCBpbnB1dExpc3QgPSBBcnJheS5mcm9tKGZvcm1FbGVtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoY29uZmlnLmlucHV0U2VsZWN0b3IpKTtcclxuICBjb25zdCBzdWJtaXRCdXR0b24gPSBmb3JtRWxlbWVudC5xdWVyeVNlbGVjdG9yKGNvbmZpZy5zdWJtaXRCdXR0b25TZWxlY3Rvcik7XHJcblxyXG4gIGlucHV0TGlzdC5mb3JFYWNoKChpbnB1dEVsZW1lbnQpID0+IHtcclxuICAgIGlucHV0RWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwiaW5wdXRcIiwgKCkgPT4ge1xyXG4gICAgICBjaGVja0lucHV0VmFsaWRpdHkoZm9ybUVsZW1lbnQsIGlucHV0RWxlbWVudCwgY29uZmlnKTtcclxuICAgICAgdG9nZ2xlQnV0dG9uU3RhdGUoaW5wdXRMaXN0LCBzdWJtaXRCdXR0b24sIGNvbmZpZyk7XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgdG9nZ2xlQnV0dG9uU3RhdGUoaW5wdXRMaXN0LCBzdWJtaXRCdXR0b24sIGNvbmZpZyk7XHJcbn07XHJcblxyXG5leHBvcnQgY29uc3QgZW5hYmxlVmFsaWRhdGlvbiA9IChjb25maWcpID0+IHtcclxuICBjb25zdCBmb3JtcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoY29uZmlnLmZvcm1TZWxlY3Rvcik7XHJcbiAgZm9ybXMuZm9yRWFjaCgoZm9ybUVsZW1lbnQpID0+IHtcclxuICAgIHNldEV2ZW50TGlzdGVuZXJzKGZvcm1FbGVtZW50LCBjb25maWcpO1xyXG4gIH0pO1xyXG59O1xyXG5cclxuY29uc3QgdmFsaWRhdGVGb3JtID0gKGZvcm1FbGVtZW50LCBjb25maWcpID0+IHtcclxuICBjb25zdCBpbnB1dExpc3QgPSBBcnJheS5mcm9tKGZvcm1FbGVtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoY29uZmlnLmlucHV0U2VsZWN0b3IpKTtcclxuICBsZXQgaXNWYWxpZCA9IHRydWU7XHJcblxyXG4gIGlucHV0TGlzdC5mb3JFYWNoKChpbnB1dEVsZW1lbnQpID0+IHtcclxuICAgIGNoZWNrSW5wdXRWYWxpZGl0eShmb3JtRWxlbWVudCwgaW5wdXRFbGVtZW50LCBjb25maWcpO1xyXG4gICAgaWYgKCFpbnB1dEVsZW1lbnQudmFsaWRpdHkudmFsaWQpIHtcclxuICAgICAgaXNWYWxpZCA9IGZhbHNlO1xyXG4gICAgfVxyXG4gIH0pO1xyXG5cclxuICBjb25zdCBzdWJtaXRCdXR0b24gPSBmb3JtRWxlbWVudC5xdWVyeVNlbGVjdG9yKGNvbmZpZy5zdWJtaXRCdXR0b25TZWxlY3Rvcik7XHJcbiAgdG9nZ2xlQnV0dG9uU3RhdGUoaW5wdXRMaXN0LCBzdWJtaXRCdXR0b24sIGNvbmZpZyk7XHJcbiAgXHJcbiAgcmV0dXJuIGlzVmFsaWQ7XHJcbn07XHJcbiIsImNsYXNzIEFwaSB7XHJcbiAgY29uc3RydWN0b3IoeyBiYXNlVXJsLCBoZWFkZXJzIH0pIHtcclxuICAgIHRoaXMuX2Jhc2VVcmwgPSBiYXNlVXJsO1xyXG4gICAgdGhpcy5faGVhZGVycyA9IGhlYWRlcnM7XHJcbiAgfVxyXG5cclxuICBfY2hlY2tSZXNwb25zZShyZXMpIHtcclxuICAgIGlmIChyZXMub2spIHtcclxuICAgICAgcmV0dXJuIHJlcy5qc29uKCk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QobmV3IEVycm9yKGBFcnJvcjogJHtyZXMuc3RhdHVzfWApKTtcclxuICB9XHJcblxyXG4gIF9yZXF1ZXN0KGVuZHBvaW50LCBvcHRpb25zID0ge30pIHtcclxuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfSR7ZW5kcG9pbnR9YCwgb3B0aW9ucylcclxuICAgICAgLnRoZW4odGhpcy5fY2hlY2tSZXNwb25zZSlcclxuICAgICAgLmNhdGNoKHRoaXMuaGFuZGxlRXJyb3IpO1xyXG4gIH1cclxuXHJcbiAgZ2V0VXNlckluZm8oKSB7XHJcbiAgICByZXR1cm4gdGhpcy5fcmVxdWVzdChcIi91c2Vycy9tZVwiLCB7XHJcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnNcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgZ2V0SW5pdGlhbENhcmRzKCkge1xyXG4gICAgcmV0dXJuIHRoaXMuX3JlcXVlc3QoXCIvY2FyZHNcIiwge1xyXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzXHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIGVkaXRQcm9maWxlQXZhdGFyKHsgYXZhdGFyIH0pIHtcclxuICAgIHJldHVybiB0aGlzLl9yZXF1ZXN0KFwiL3VzZXJzL21lL2F2YXRhclwiLCB7XHJcbiAgICAgIG1ldGhvZDogXCJQQVRDSFwiLFxyXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxyXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7IGF2YXRhciB9KVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBlZGl0VXNlckluZm8oeyBuYW1lLCBhYm91dCB9KSB7XHJcbiAgICByZXR1cm4gdGhpcy5fcmVxdWVzdChcIi91c2Vycy9tZVwiLCB7XHJcbiAgICAgIG1ldGhvZDogXCJQQVRDSFwiLFxyXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxyXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7IG5hbWUsIGFib3V0IH0pXHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIGFkZE5ld0NhcmQoeyBuYW1lLCBsaW5rIH0pIHtcclxuICAgIHJldHVybiB0aGlzLl9yZXF1ZXN0KFwiL2NhcmRzXCIsIHtcclxuICAgICAgbWV0aG9kOiBcIlBPU1RcIixcclxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcclxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoeyBuYW1lLCBsaW5rIH0pXHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIGRlbGV0ZUNhcmQoY2FyZElkKSB7XHJcbiAgICByZXR1cm4gdGhpcy5fcmVxdWVzdChgL2NhcmRzLyR7Y2FyZElkfWAsIHtcclxuICAgICAgbWV0aG9kOiBcIkRFTEVURVwiLFxyXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzXHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIHRvZ2dsZUxpa2UoY2FyZElkLCBpc0xpa2VkKSB7XHJcbiAgICByZXR1cm4gdGhpcy5fcmVxdWVzdChgL2NhcmRzLyR7Y2FyZElkfS9saWtlc2AsIHtcclxuICAgICAgbWV0aG9kOiBpc0xpa2VkID8gXCJQVVRcIiA6IFwiREVMRVRFXCIsXHJcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnNcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgZ2V0VXNlckFuZENhcmRzKCkge1xyXG4gICAgcmV0dXJuIFByb21pc2UuYWxsKFt0aGlzLmdldFVzZXJJbmZvKCksIHRoaXMuZ2V0SW5pdGlhbENhcmRzKCldKVxyXG4gICAgICAudGhlbigoW3VzZXJEYXRhLCBjYXJkc10pID0+ICh7IHVzZXJEYXRhLCBjYXJkcyB9KSk7XHJcbiAgfVxyXG5cclxuICBoYW5kbGVFcnJvcihlcnIpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoXCJBUEkgRXJyb3I6IFwiLCBlcnIpO1xyXG4gICAgdGhyb3cgZXJyOyAgXHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgZGVmYXVsdCBBcGk7XHJcbiIsImV4cG9ydCBmdW5jdGlvbiByZW5kZXJMb2FkaW5nKGlzTG9hZGluZywgYnV0dG9uLCBidXR0b25UZXh0ID0gJ1NhdmUnLCBsb2FkaW5nVGV4dCA9ICdTYXZpbmcuLi4nKSB7XHJcbiAgICBpZiAoaXNMb2FkaW5nKSB7XHJcbiAgICAgIGJ1dHRvbi50ZXh0Q29udGVudCA9IGxvYWRpbmdUZXh0O1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgYnV0dG9uLnRleHRDb250ZW50ID0gYnV0dG9uVGV4dDtcclxuICAgIH1cclxuICB9XHJcbiAgXHJcbiAgZXhwb3J0IGZ1bmN0aW9uIGhhbmRsZVN1Ym1pdChyZXF1ZXN0LCBldnQsIGxvYWRpbmdUZXh0ID0gJ1NhdmluZy4uLicpIHtcclxuICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gIFxyXG4gICAgY29uc3Qgc3VibWl0QnV0dG9uID0gZXZ0LnN1Ym1pdHRlcjtcclxuICAgIGNvbnN0IGluaXRpYWxUZXh0ID0gc3VibWl0QnV0dG9uLnRleHRDb250ZW50O1xyXG4gIFxyXG4gICAgcmVuZGVyTG9hZGluZyh0cnVlLCBzdWJtaXRCdXR0b24sIGluaXRpYWxUZXh0LCBsb2FkaW5nVGV4dCk7XHJcbiAgXHJcbiAgICByZXR1cm4gcmVxdWVzdCgpXHJcbiAgICAgIC50aGVuKCgpID0+IHtcclxuICAgICAgICBldnQudGFyZ2V0LnJlc2V0KCk7XHJcbiAgICAgIH0pXHJcbiAgICAgIC5jYXRjaChjb25zb2xlLmVycm9yKSAgXHJcbiAgICAgIC5maW5hbGx5KCgpID0+IHtcclxuICAgICAgICByZW5kZXJMb2FkaW5nKGZhbHNlLCBzdWJtaXRCdXR0b24sIGluaXRpYWxUZXh0KTtcclxuICAgICAgfSk7XHJcbiAgfVxyXG4gICIsIi8vIGluZGV4LmpzXHJcblxyXG5pbXBvcnQgXCIuL2luZGV4LmNzc1wiO1xyXG5pbXBvcnQgeyBTZXR0aW5ncywgcmVzZXRWYWxpZGF0aW9uLCBlbmFibGVWYWxpZGF0aW9uIH0gZnJvbSBcIi4uL3ZhbGlkYXRpb24uanNcIjtcclxuaW1wb3J0IEFwaSBmcm9tIFwiLi4vdXRpbHMvQXBpLmpzXCI7XHJcbmltcG9ydCBsb2dvIGZyb20gXCIuLi9pbWFnZXMvbG9nby5zdmdcIjtcclxuaW1wb3J0IGF2YXRhciBmcm9tIFwiLi4vaW1hZ2VzL2F2YXRhci5qcGdcIjtcclxuaW1wb3J0IHBlbmNpbEljb24gZnJvbSBcIi4uL2ltYWdlcy9wZW5jaWwtaWNvbi5zdmdcIjtcclxuaW1wb3J0IHBsdXNJY29uIGZyb20gXCIuLi9pbWFnZXMvcGx1cy5zdmdcIjtcclxuaW1wb3J0IHsgcmVuZGVyTG9hZGluZywgaGFuZGxlU3VibWl0IH0gZnJvbSBcIi4uL3V0aWxzL2Zvcm1oYW5kbGVyLmpzXCI7XHJcblxyXG5jb25zdCBjYXJkTGlzdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZHNfX2xpc3RcIik7XHJcbmNvbnN0IGNhcmRUZW1wbGF0ZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjY2FyZC10ZW1wbGF0ZVwiKTtcclxuY29uc3QgcHJldmlld01vZGFsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNwcmV2aWV3LW1vZGFsXCIpO1xyXG5jb25zdCBtb2RhbEltYWdlID0gcHJldmlld01vZGFsPy5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19pbWFnZVwiKTtcclxuY29uc3QgbW9kYWxDYXB0aW9uID0gcHJldmlld01vZGFsPy5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19jYXB0aW9uXCIpO1xyXG5jb25zdCBwcm9maWxlTmFtZUVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX25hbWVcIik7XHJcbmNvbnN0IHByb2ZpbGVKb2JFbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19kZXNjcmlwdGlvblwiKTtcclxuY29uc3QgZWRpdFByb2ZpbGVNb2RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjZWRpdC1wcm9maWxlLW1vZGFsXCIpO1xyXG5jb25zdCBuZXdQb3N0TW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI25ldy1wb3N0LW1vZGFsXCIpO1xyXG5jb25zdCBhdmF0YXJQcmV2aWV3ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19hdmF0YXJcIik7XHJcbmNvbnN0IGF2YXRhckVkaXRCdG4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX3BpY3R1cmUtYnRuXCIpO1xyXG5jb25zdCBwcm9maWxlQWRkQnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19hZGQtYnRuXCIpO1xyXG5jb25zdCBjbG9zZUJ0bnMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLm1vZGFsX19jbG9zZS1idG4sIC5tb2RhbF9fY2xvc2UtcHJldmlld1wiKTtcclxuY29uc3QgZGVsZXRlTW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2RlbGV0ZS1tb2RhbFwiKTtcclxuY29uc3QgZGVsZXRlQ29uZmlybUJ0biA9IGRlbGV0ZU1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX3N1Ym1pdC1idG5fZGVsZXRlXCIpO1xyXG5jb25zdCBkZWxldGVDYW5jZWxCdG4gPSBkZWxldGVNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19zdWJtaXQtYnRuX2NhbmNlbFwiKTtcclxuY29uc3QgYXZhdGFyTW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2VkaXQtYXZhdGFyLW1vZGFsXCIpO1xyXG5jb25zdCBhdmF0YXJJbnB1dCA9IGF2YXRhck1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIjYXZhdGFyX3VybFwiKTtcclxuY29uc3QgYXZhdGFyU3VibWl0QnRuID0gYXZhdGFyTW9kYWwucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fc3VibWl0LWJ0blwiKTtcclxuY29uc3QgcHJvZmlsZUVkaXRCdG4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX2VkaXQtYnRuXCIpO1xyXG5jb25zdCBwcm9maWxlRm9ybSA9IGRvY3VtZW50LmZvcm1zW1wiZWRpdC1wcm9maWxlXCJdO1xyXG5jb25zdCBhdmF0YXJGb3JtID0gZG9jdW1lbnQuZm9ybXNbXCJlZGl0LWF2YXRhclwiXTtcclxuY29uc3QgcG9zdEZvcm0gPSBkb2N1bWVudC5mb3Jtc1tcIm5ldy1wb3N0XCJdO1xyXG5jb25zdCBuYW1lSW5wdXQgPSBwb3N0Rm9ybS5xdWVyeVNlbGVjdG9yKFwiI25ldy1wb3N0LWNhcHRpb24taW5wdXRcIik7XHJcbmNvbnN0IGltYWdlVXJsSW5wdXQgPSBwb3N0Rm9ybS5xdWVyeVNlbGVjdG9yKFwiI2ltYWdlX3VybFwiKTtcclxuXHJcblxyXG5sZXQgc2VsZWN0ZWRDYXJkO1xyXG5sZXQgc2VsZWN0ZWRDYXJkSWQ7XHJcbmxldCBjdXJyZW50VXNlcklkO1xyXG5cclxuY29uc3QgYXBpID0gbmV3IEFwaSh7XHJcbiAgYmFzZVVybDogXCJodHRwczovL2Fyb3VuZC1hcGkuZW4udHJpcGxldGVuLXNlcnZpY2VzLmNvbS92MVwiLFxyXG4gIGhlYWRlcnM6IHtcclxuICAgIGF1dGhvcml6YXRpb246IFwiNDZjMWE2MzktNDIxNS00MThjLTgyMDUtODdkZWMzN2Q2OGI3XCIsXHJcbiAgICBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIlxyXG4gIH1cclxufSk7XHJcblxyXG5hcGkuZ2V0VXNlckluZm8oKVxyXG4gIC50aGVuKHVzZXJEYXRhID0+IHtcclxuICAgIGN1cnJlbnRVc2VySWQgPSB1c2VyRGF0YS5faWQ7XHJcbiAgICBwcm9maWxlTmFtZUVsZW1lbnQudGV4dENvbnRlbnQgPSB1c2VyRGF0YS5uYW1lO1xyXG4gICAgcHJvZmlsZUpvYkVsZW1lbnQudGV4dENvbnRlbnQgPSB1c2VyRGF0YS5hYm91dDtcclxuICAgIGF2YXRhclByZXZpZXcuc3JjID0gdXNlckRhdGEuYXZhdGFyIHx8IGF2YXRhcjtcclxuICB9KVxyXG4gIC5jYXRjaChlcnIgPT4gY29uc29sZS5lcnJvcihcIkVycm9yIGZldGNoaW5nIHVzZXIgaW5mbzpcIiwgZXJyKSk7XHJcblxyXG5hcGkuZ2V0SW5pdGlhbENhcmRzKClcclxuICAudGhlbihjYXJkcyA9PiB7XHJcbiAgICBjYXJkcy5mb3JFYWNoKGNhcmQgPT4ge1xyXG4gICAgICBjb25zdCBjYXJkRWxlbWVudCA9IGNyZWF0ZUNhcmRFbGVtZW50KGNhcmQpO1xyXG4gICAgICBjYXJkTGlzdC5hcHBlbmRDaGlsZChjYXJkRWxlbWVudCk7XHJcbiAgICB9KTtcclxuICB9KVxyXG4gIC5jYXRjaChlcnIgPT4gY29uc29sZS5lcnJvcihcIkVycm9yIGxvYWRpbmcgY2FyZHM6XCIsIGVycikpO1xyXG5cclxuZnVuY3Rpb24gY3JlYXRlQ2FyZEVsZW1lbnQoZGF0YSkge1xyXG4gIGNvbnN0IGNhcmRFbGVtZW50ID0gY2FyZFRlbXBsYXRlLmNvbnRlbnQucXVlcnlTZWxlY3RvcihcImxpXCIpLmNsb25lTm9kZSh0cnVlKTtcclxuICBjb25zdCBjYXJkSW1hZ2UgPSBjYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX2ltYWdlXCIpO1xyXG4gIGNvbnN0IGNhcmRUaXRsZSA9IGNhcmRFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9fdGl0bGVcIik7XHJcbiAgY29uc3QgY2FyZExpa2VkQnRuID0gY2FyZEVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkX19saWtlLWJ0blwiKTtcclxuICBjb25zdCBkZWxldGVCdG4gPSBjYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX2RlbGV0ZS1idG5cIik7XHJcblxyXG4gIGNhcmRJbWFnZS5zcmMgPSBkYXRhLmxpbms7XHJcbiAgY2FyZEltYWdlLmFsdCA9IGRhdGEubmFtZTtcclxuICBjYXJkVGl0bGUudGV4dENvbnRlbnQgPSBkYXRhLm5hbWU7XHJcblxyXG4gIGlmIChkYXRhLmlzTGlrZWQpIHtcclxuICAgIGNhcmRMaWtlZEJ0bi5jbGFzc0xpc3QuYWRkKFwiY2FyZF9fbGlrZS1idG4tLWxpa2VkXCIpO1xyXG4gIH1cclxuXHJcbiAgY2FyZExpa2VkQnRuLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XHJcbiAgICBjb25zdCBpc0N1cnJlbnRseUxpa2VkID0gY2FyZExpa2VkQnRuLmNsYXNzTGlzdC5jb250YWlucyhcImNhcmRfX2xpa2UtYnRuLS1saWtlZFwiKTtcclxuXHJcbiAgICBhcGkudG9nZ2xlTGlrZShkYXRhLl9pZCwgIWlzQ3VycmVudGx5TGlrZWQpXHJcbiAgICAgIC50aGVuKHVwZGF0ZWRDYXJkID0+IHtcclxuICAgICAgICBjYXJkTGlrZWRCdG4uY2xhc3NMaXN0LnRvZ2dsZShcImNhcmRfX2xpa2UtYnRuLS1saWtlZFwiLCB1cGRhdGVkQ2FyZC5pc0xpa2VkKTtcclxuICAgICAgfSlcclxuICAgICAgLmNhdGNoKGVyciA9PiBjb25zb2xlLmVycm9yKFwiRXJyb3IgdG9nZ2xpbmcgbGlrZTpcIiwgZXJyKSk7XHJcbiAgfSk7XHJcblxyXG4gIGNhcmRJbWFnZS5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4gb3BlbkltYWdlTW9kYWwoZGF0YS5saW5rLCBkYXRhLm5hbWUpKTtcclxuXHJcbiAgZGVsZXRlQnRuLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoZSkgPT4ge1xyXG4gICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcclxuICAgIHNlbGVjdGVkQ2FyZCA9IGNhcmRFbGVtZW50O1xyXG4gICAgc2VsZWN0ZWRDYXJkSWQgPSBkYXRhLl9pZDtcclxuICAgIG9wZW5Qb3B1cChkZWxldGVNb2RhbCk7XHJcbiAgfSk7XHJcblxyXG4gIHJldHVybiBjYXJkRWxlbWVudDtcclxufVxyXG5cclxuZGVsZXRlQ29uZmlybUJ0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKGV2ZW50KSA9PiB7XHJcbiAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcclxuICBpZiAoc2VsZWN0ZWRDYXJkSWQpIHtcclxuICAgIGNvbnN0IG9yaWdpbmFsVGV4dCA9IGRlbGV0ZUNvbmZpcm1CdG4udGV4dENvbnRlbnQ7XHJcbiAgICBkZWxldGVDb25maXJtQnRuLnRleHRDb250ZW50ID0gXCJEZWxldGluZy4uLlwiO1xyXG5cclxuICAgIGFwaS5kZWxldGVDYXJkKHNlbGVjdGVkQ2FyZElkKVxyXG4gICAgICAudGhlbigoKSA9PiB7XHJcbiAgICAgICAgc2VsZWN0ZWRDYXJkLnJlbW92ZSgpO1xyXG4gICAgICAgIHNlbGVjdGVkQ2FyZCA9IG51bGw7XHJcbiAgICAgICAgc2VsZWN0ZWRDYXJkSWQgPSBudWxsO1xyXG4gICAgICAgIGNsb3NlUG9wdXAoZGVsZXRlTW9kYWwpO1xyXG4gICAgICB9KVxyXG4gICAgICAuY2F0Y2goZXJyID0+IGNvbnNvbGUuZXJyb3IoXCJFcnJvciBkZWxldGluZyBjYXJkOlwiLCBlcnIpKVxyXG4gICAgICAuZmluYWxseSgoKSA9PiB7XHJcbiAgICAgICAgZGVsZXRlQ29uZmlybUJ0bi50ZXh0Q29udGVudCA9IG9yaWdpbmFsVGV4dDtcclxuICAgICAgfSk7XHJcbiAgfVxyXG59KTtcclxuXHJcbmRlbGV0ZUNhbmNlbEJ0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xyXG4gIGNsb3NlUG9wdXAoZGVsZXRlTW9kYWwpO1xyXG4gIHNlbGVjdGVkQ2FyZCA9IG51bGw7XHJcbiAgc2VsZWN0ZWRDYXJkSWQgPSBudWxsO1xyXG59KTtcclxuXHJcbmF2YXRhckVkaXRCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcclxuICBvcGVuUG9wdXAoYXZhdGFyTW9kYWwpO1xyXG4gIHJlc2V0VmFsaWRhdGlvbihhdmF0YXJGb3JtLCBTZXR0aW5ncyk7XHJcbn0pO1xyXG5cclxuZnVuY3Rpb24gZWRpdEF2YXRhckZvcm1TdWJtaXQoZXZ0KSB7XHJcbiAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XHJcbiAgY29uc3QgYXZhdGFyVXJsID0gYXZhdGFySW5wdXQudmFsdWUudHJpbSgpO1xyXG5cclxuICBpZiAoYXZhdGFyVXJsKSB7XHJcbiAgICBjb25zdCBvcmlnaW5hbFRleHQgPSBhdmF0YXJTdWJtaXRCdG4udGV4dENvbnRlbnQ7XHJcbiAgICBhdmF0YXJTdWJtaXRCdG4udGV4dENvbnRlbnQgPSBcIlNhdmluZy4uLlwiO1xyXG5cclxuICAgIGZ1bmN0aW9uIG1ha2VSZXF1ZXN0KCkge1xyXG4gICAgICByZXR1cm4gYXBpLmVkaXRQcm9maWxlQXZhdGFyKHsgYXZhdGFyOiBhdmF0YXJVcmwgfSlcclxuICAgICAgICAudGhlbih1c2VyRGF0YSA9PiB7XHJcbiAgICAgICAgICBhdmF0YXJQcmV2aWV3LnNyYyA9IHVzZXJEYXRhLmF2YXRhciB8fCBhdmF0YXI7XHJcbiAgICAgICAgICBjbG9zZVBvcHVwKGF2YXRhck1vZGFsKTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBoYW5kbGVTdWJtaXQobWFrZVJlcXVlc3QsIGV2dClcclxuICAgICAgLmZpbmFsbHkoKCkgPT4ge1xyXG4gICAgICAgIGF2YXRhclN1Ym1pdEJ0bi50ZXh0Q29udGVudCA9IG9yaWdpbmFsVGV4dDtcclxuICAgICAgfSk7XHJcbiAgfVxyXG59XHJcblxyXG5mdW5jdGlvbiBvcGVuSW1hZ2VNb2RhbChpbWFnZVVybCwgaW1hZ2VDYXB0aW9uKSB7XHJcbiAgaWYgKCFwcmV2aWV3TW9kYWwgfHwgIW1vZGFsSW1hZ2UgfHwgIW1vZGFsQ2FwdGlvbikgcmV0dXJuO1xyXG4gIG1vZGFsSW1hZ2Uuc3JjID0gaW1hZ2VVcmw7XHJcbiAgbW9kYWxJbWFnZS5hbHQgPSBpbWFnZUNhcHRpb247XHJcbiAgbW9kYWxDYXB0aW9uLnRleHRDb250ZW50ID0gaW1hZ2VDYXB0aW9uO1xyXG4gIG9wZW5Qb3B1cChwcmV2aWV3TW9kYWwpO1xyXG59XHJcblxyXG5mdW5jdGlvbiBvcGVuUG9wdXAocG9wdXApIHtcclxuICBwb3B1cC5jbGFzc0xpc3QuYWRkKFwibW9kYWwtLW9wZW5lZFwiKTtcclxuICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwia2V5ZG93blwiLCBoYW5kbGVFc2NLZXkpO1xyXG4gIHBvcHVwLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBoYW5kbGVDbGlja091dHNpZGVNb2RhbCk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGNsb3NlUG9wdXAocG9wdXApIHtcclxuICBwb3B1cC5jbGFzc0xpc3QucmVtb3ZlKFwibW9kYWwtLW9wZW5lZFwiKTtcclxuICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKFwia2V5ZG93blwiLCBoYW5kbGVFc2NLZXkpO1xyXG4gIHBvcHVwLnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBoYW5kbGVDbGlja091dHNpZGVNb2RhbCk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGhhbmRsZUVzY0tleShldmVudCkge1xyXG4gIGlmIChldmVudC5rZXkgPT09IFwiRXNjYXBlXCIpIHtcclxuICAgIGNvbnN0IG9wZW5lZE1vZGFsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5tb2RhbC0tb3BlbmVkXCIpO1xyXG4gICAgaWYgKG9wZW5lZE1vZGFsKSBjbG9zZVBvcHVwKG9wZW5lZE1vZGFsKTtcclxuICB9XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGhhbmRsZUNsaWNrT3V0c2lkZU1vZGFsKGUpIHtcclxuICBpZiAoZS50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKFwibW9kYWxcIikpIGNsb3NlUG9wdXAoZS50YXJnZXQpO1xyXG59XHJcblxyXG5mdW5jdGlvbiBoYW5kbGVQcm9maWxlRm9ybVN1Ym1pdChldnQpIHtcclxuICBmdW5jdGlvbiBtYWtlUmVxdWVzdCgpIHtcclxuICAgIHJldHVybiBhcGkuZWRpdFVzZXJJbmZvKHtcclxuICAgICAgbmFtZTogcHJvZmlsZUZvcm0ubmFtZS52YWx1ZSxcclxuICAgICAgYWJvdXQ6IHByb2ZpbGVGb3JtLmRlc2NyaXB0aW9uLnZhbHVlXHJcbiAgICB9KS50aGVuKHVzZXJEYXRhID0+IHtcclxuICAgICAgcHJvZmlsZU5hbWVFbGVtZW50LnRleHRDb250ZW50ID0gdXNlckRhdGEubmFtZTtcclxuICAgICAgcHJvZmlsZUpvYkVsZW1lbnQudGV4dENvbnRlbnQgPSB1c2VyRGF0YS5hYm91dDtcclxuICAgICAgY2xvc2VQb3B1cChlZGl0UHJvZmlsZU1vZGFsKTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgaGFuZGxlU3VibWl0KG1ha2VSZXF1ZXN0LCBldnQpO1xyXG59XHJcblxyXG5mdW5jdGlvbiBoYW5kbGVDYXJkRm9ybVN1Ym1pdChldnQpIHtcclxuICBldnQucHJldmVudERlZmF1bHQoKTtcclxuICBcclxuICBjb25zdCBuYW1lID0gbmFtZUlucHV0LnZhbHVlLnRyaW0oKTtcclxuICBjb25zdCBsaW5rID0gaW1hZ2VVcmxJbnB1dC52YWx1ZS50cmltKCk7XHJcblxyXG4gIGZ1bmN0aW9uIG1ha2VSZXF1ZXN0KCkge1xyXG4gICAgcmV0dXJuIGFwaS5hZGROZXdDYXJkKHsgbmFtZSwgbGluayB9KVxyXG4gICAgICAudGhlbigoY2FyZERhdGEpID0+IHtcclxuICAgICAgICBjb25zdCBjYXJkRWxlbWVudCA9IGNyZWF0ZUNhcmRFbGVtZW50KGNhcmREYXRhKTtcclxuICAgICAgICBjYXJkTGlzdC5wcmVwZW5kKGNhcmRFbGVtZW50KTtcclxuICAgICAgICBjbG9zZVBvcHVwKG5ld1Bvc3RNb2RhbCk7XHJcbiAgICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgaGFuZGxlU3VibWl0KG1ha2VSZXF1ZXN0LCBldnQpO1xyXG59XHJcblxyXG5mdW5jdGlvbiB0b2dnbGVTdWJtaXRCdXR0b24ocG9zdEZvcm0pIHtcclxuICBpZiAoIXBvc3RGb3JtKSB7XHJcbiAgICBjb25zb2xlLndhcm4oXCJQb3N0IGZvcm0gbm90IHByb3ZpZGVkIVwiKTtcclxuICAgIHJldHVybjtcclxuICB9XHJcblxyXG4gIGNvbnN0IHN1Ym1pdEJ1dHRvbiA9IHBvc3RGb3JtLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX3N1Ym1pdC1idG5cIik7XHJcbiAgY29uc3QgY2FwdGlvbiA9IHBvc3RGb3JtLnF1ZXJ5U2VsZWN0b3IoXCIjbmV3LXBvc3QtY2FwdGlvbi1pbnB1dFwiKTtcclxuICBjb25zdCBpbWFnZVVybCA9IHBvc3RGb3JtLnF1ZXJ5U2VsZWN0b3IoXCIjaW1hZ2VfdXJsXCIpO1xyXG5cclxuICBpZiAoIXN1Ym1pdEJ1dHRvbiB8fCAhY2FwdGlvbiB8fCAhaW1hZ2VVcmwpIHtcclxuICAgIGNvbnNvbGUud2FybihcIkZvcm0gZWxlbWVudHMgbm90IGZvdW5kLlwiKTtcclxuICAgIHJldHVybjtcclxuICB9XHJcblxyXG4gIGNvbnN0IGlzVmFsaWQgPSBjYXB0aW9uLnZhbHVlLnRyaW0oKSAhPT0gXCJcIiAmJiBpbWFnZVVybC52YWx1ZS50cmltKCkgIT09IFwiXCI7XHJcbiAgc3VibWl0QnV0dG9uLmRpc2FibGVkID0gIWlzVmFsaWQ7XHJcbiAgc3VibWl0QnV0dG9uLmNsYXNzTGlzdC50b2dnbGUoXCJkaXNhYmxlZFwiLCAhaXNWYWxpZCk7XHJcbn1cclxuXHJcbmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJET01Db250ZW50TG9hZGVkXCIsICgpID0+IHtcclxuICBwcm9maWxlQWRkQnRuLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XHJcbiAgICBjb25zdCBwb3N0Rm9ybSA9IGRvY3VtZW50LmZvcm1zW1wibmV3LXBvc3RcIl07XHJcbiAgICBvcGVuUG9wdXAobmV3UG9zdE1vZGFsKTtcclxuICAgIHJlc2V0VmFsaWRhdGlvbihwb3N0Rm9ybSwgU2V0dGluZ3MpO1xyXG5cclxuICAgIGNvbnN0IGNhcHRpb25JbnB1dCA9IHBvc3RGb3JtLnF1ZXJ5U2VsZWN0b3IoXCJpbnB1dFtuYW1lPSduZXctcG9zdC1jYXB0aW9uLWlucHV0J11cIik7XHJcbiAgICBjb25zdCBpbWFnZVVybElucHV0ID0gcG9zdEZvcm0ucXVlcnlTZWxlY3RvcihcImlucHV0W25hbWU9J2ltYWdlX3VybCddXCIpO1xyXG4gIH0pO1xyXG5cclxuICBwcm9maWxlRWRpdEJ0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xyXG4gICAgcHJvZmlsZUZvcm0ubmFtZS52YWx1ZSA9IHByb2ZpbGVOYW1lRWxlbWVudC50ZXh0Q29udGVudDtcclxuICAgIHByb2ZpbGVGb3JtLmRlc2NyaXB0aW9uLnZhbHVlID0gcHJvZmlsZUpvYkVsZW1lbnQudGV4dENvbnRlbnQ7XHJcbiAgICBvcGVuUG9wdXAoZWRpdFByb2ZpbGVNb2RhbCk7XHJcbiAgICByZXNldFZhbGlkYXRpb24ocHJvZmlsZUZvcm0sIFNldHRpbmdzKTtcclxuICB9KTtcclxuXHJcbiAgcHJvZmlsZUZvcm0uYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCBoYW5kbGVQcm9maWxlRm9ybVN1Ym1pdCk7XHJcbiAgZG9jdW1lbnQuZm9ybXNbXCJuZXctcG9zdFwiXS5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIGhhbmRsZUNhcmRGb3JtU3VibWl0KTtcclxuICBhdmF0YXJGb3JtLmFkZEV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgZWRpdEF2YXRhckZvcm1TdWJtaXQpO1xyXG5cclxuICBjbG9zZUJ0bnMuZm9yRWFjaChidG4gPT4gYnRuLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiBjbG9zZVBvcHVwKGJ0bi5jbG9zZXN0KFwiLm1vZGFsXCIpKSkpO1xyXG59KTtcclxuXHJcbmVuYWJsZVZhbGlkYXRpb24oU2V0dGluZ3MpOyJdLCJuYW1lcyI6WyJfX3dlYnBhY2tfcmVxdWlyZV9fIiwiU2V0dGluZ3MiLCJmb3JtU2VsZWN0b3IiLCJpbnB1dFNlbGVjdG9yIiwic3VibWl0QnV0dG9uU2VsZWN0b3IiLCJpbmFjdGl2ZUJ1dHRvbkNsYXNzIiwiaW5wdXRFcnJvckNsYXNzIiwiZXJyb3JDbGFzcyIsImhpZGVJbnB1dEVycm9yIiwiaW5wdXRFbGVtZW50IiwiY29uZmlnIiwiZXJyb3JFbGVtZW50IiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwiaWQiLCJjbGFzc0xpc3QiLCJyZW1vdmUiLCJ0ZXh0Q29udGVudCIsInJlc2V0VmFsaWRhdGlvbiIsImZvcm1FbGVtZW50IiwiaW5wdXRMaXN0IiwiQXJyYXkiLCJmcm9tIiwicXVlcnlTZWxlY3RvckFsbCIsInN1Ym1pdEJ1dHRvbiIsImZvckVhY2giLCJ0b2dnbGVCdXR0b25TdGF0ZSIsImJ1dHRvbkVsZW1lbnQiLCJzb21lIiwiaW5wdXQiLCJ2YWxpZGl0eSIsInZhbGlkIiwiaGFzSW52YWxpZElucHV0IiwiYWRkIiwic2V0QXR0cmlidXRlIiwicmVtb3ZlQXR0cmlidXRlIiwicmVuZGVyTG9hZGluZyIsImlzTG9hZGluZyIsImJ1dHRvbiIsImJ1dHRvblRleHQiLCJhcmd1bWVudHMiLCJsZW5ndGgiLCJ1bmRlZmluZWQiLCJsb2FkaW5nVGV4dCIsImhhbmRsZVN1Ym1pdCIsInJlcXVlc3QiLCJldnQiLCJwcmV2ZW50RGVmYXVsdCIsInN1Ym1pdHRlciIsImluaXRpYWxUZXh0IiwidGhlbiIsInRhcmdldCIsInJlc2V0IiwiY2F0Y2giLCJjb25zb2xlIiwiZXJyb3IiLCJmaW5hbGx5IiwiY2FyZExpc3QiLCJjYXJkVGVtcGxhdGUiLCJwcmV2aWV3TW9kYWwiLCJtb2RhbEltYWdlIiwibW9kYWxDYXB0aW9uIiwicHJvZmlsZU5hbWVFbGVtZW50IiwicHJvZmlsZUpvYkVsZW1lbnQiLCJlZGl0UHJvZmlsZU1vZGFsIiwibmV3UG9zdE1vZGFsIiwiYXZhdGFyUHJldmlldyIsImF2YXRhckVkaXRCdG4iLCJwcm9maWxlQWRkQnRuIiwiY2xvc2VCdG5zIiwiZGVsZXRlTW9kYWwiLCJkZWxldGVDb25maXJtQnRuIiwiZGVsZXRlQ2FuY2VsQnRuIiwiYXZhdGFyTW9kYWwiLCJhdmF0YXJJbnB1dCIsImF2YXRhclN1Ym1pdEJ0biIsInByb2ZpbGVFZGl0QnRuIiwicHJvZmlsZUZvcm0iLCJmb3JtcyIsImF2YXRhckZvcm0iLCJwb3N0Rm9ybSIsIm5hbWVJbnB1dCIsImltYWdlVXJsSW5wdXQiLCJzZWxlY3RlZENhcmQiLCJzZWxlY3RlZENhcmRJZCIsImN1cnJlbnRVc2VySWQiLCJhcGkiLCJjb25zdHJ1Y3RvciIsIl9yZWYiLCJiYXNlVXJsIiwiaGVhZGVycyIsInRoaXMiLCJfYmFzZVVybCIsIl9oZWFkZXJzIiwiX2NoZWNrUmVzcG9uc2UiLCJyZXMiLCJvayIsImpzb24iLCJQcm9taXNlIiwicmVqZWN0IiwiRXJyb3IiLCJzdGF0dXMiLCJfcmVxdWVzdCIsImVuZHBvaW50Iiwib3B0aW9ucyIsImZldGNoIiwiaGFuZGxlRXJyb3IiLCJnZXRVc2VySW5mbyIsImdldEluaXRpYWxDYXJkcyIsImVkaXRQcm9maWxlQXZhdGFyIiwiX3JlZjIiLCJhdmF0YXIiLCJtZXRob2QiLCJib2R5IiwiSlNPTiIsInN0cmluZ2lmeSIsImVkaXRVc2VySW5mbyIsIl9yZWYzIiwibmFtZSIsImFib3V0IiwiYWRkTmV3Q2FyZCIsIl9yZWY0IiwibGluayIsImRlbGV0ZUNhcmQiLCJjYXJkSWQiLCJ0b2dnbGVMaWtlIiwiaXNMaWtlZCIsImdldFVzZXJBbmRDYXJkcyIsImFsbCIsIl9yZWY1IiwidXNlckRhdGEiLCJjYXJkcyIsImVyciIsImF1dGhvcml6YXRpb24iLCJjcmVhdGVDYXJkRWxlbWVudCIsImRhdGEiLCJjYXJkRWxlbWVudCIsImNvbnRlbnQiLCJjbG9uZU5vZGUiLCJjYXJkSW1hZ2UiLCJjYXJkVGl0bGUiLCJjYXJkTGlrZWRCdG4iLCJkZWxldGVCdG4iLCJzcmMiLCJhbHQiLCJhZGRFdmVudExpc3RlbmVyIiwiaXNDdXJyZW50bHlMaWtlZCIsImNvbnRhaW5zIiwiX2lkIiwidXBkYXRlZENhcmQiLCJ0b2dnbGUiLCJvcGVuSW1hZ2VNb2RhbCIsImltYWdlVXJsIiwiaW1hZ2VDYXB0aW9uIiwib3BlblBvcHVwIiwiZSIsInN0b3BQcm9wYWdhdGlvbiIsImVkaXRBdmF0YXJGb3JtU3VibWl0IiwiYXZhdGFyVXJsIiwidmFsdWUiLCJ0cmltIiwib3JpZ2luYWxUZXh0IiwibWFrZVJlcXVlc3QiLCJjbG9zZVBvcHVwIiwicG9wdXAiLCJoYW5kbGVFc2NLZXkiLCJoYW5kbGVDbGlja091dHNpZGVNb2RhbCIsInJlbW92ZUV2ZW50TGlzdGVuZXIiLCJldmVudCIsImtleSIsIm9wZW5lZE1vZGFsIiwiaGFuZGxlUHJvZmlsZUZvcm1TdWJtaXQiLCJkZXNjcmlwdGlvbiIsImhhbmRsZUNhcmRGb3JtU3VibWl0IiwiY2FyZERhdGEiLCJwcmVwZW5kIiwiY2FyZCIsImFwcGVuZENoaWxkIiwiYnRuIiwiY2xvc2VzdCIsInNldEV2ZW50TGlzdGVuZXJzIiwiY2hlY2tJbnB1dFZhbGlkaXR5Iiwic2hvd0lucHV0RXJyb3IiLCJlcnJvck1lc3NhZ2UiLCJ2YWxpZGF0aW9uTWVzc2FnZSJdLCJzb3VyY2VSb290IjoiIn0=